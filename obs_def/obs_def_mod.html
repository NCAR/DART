<!--
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
!!                                                                       !!
!!                   GNU General Public License                          !!
!!                                                                       !!
!! This file is part of the Data Assimilation Research Testbed (DART).   !!
!!                                                                       !!
!! DART is free software; you can redistribute it and/or modify          !!
!! it and are expected to follow the terms of the GNU General Public     !!
!! License as published by the Free Software Foundation.                 !!
!!                                                                       !!
!! DART is distributed in the hope that it will be useful,               !!
!! but WITHOUT ANY WARRANTY; without even the implied warranty of        !!
!! MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the         !!
!! GNU General Public License for more details.                          !!
!!                                                                       !!
!! You should have received a copy of the GNU General Public License     !!
!! along with DART; if not, write to:                                    !!
!!          Free Software Foundation, Inc.                               !!
!!          59 Temple Place, Suite 330                                   !!
!!          Boston, MA  02111-1307  USA                                  !!
!! or see:                                                               !!
!!          http://www.gnu.org/licenses/gpl.txt                          !!
!!                                                                       !!
!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-->

<HTML>
<TITLE>module obs_def_mod</TITLE>
<link rel=stylesheet type=text/css href=../doc/html/doc.css>
<BODY>

<DIV ALIGN=CENTER>
<A HREF="#Interface">INTERFACE</A> / 
<A HREF="#PublicEntities">PUBLIC COMPONENTS</A> / 
<A HREF="#Namelist">NAMELIST</A> / 
<A HREF="#FilesUsed">FILES</A> /
<A HREF="#References">REFERENCES</A> /
<A HREF="#Errors">ERRORS</A> /
<A HREF="#KnownBugs">BUGS</A> /
<A HREF="#FuturePlans">PLANS</A> /
</DIV>

<!--==================================================================-->

<H1>MODULE obs_def_mod</H1>
<A NAME="HEADER"></A>
<TABLE summary="">
   <TR><TD>Contact:       </TD><TD> Jeff Anderson                </TD></TR>
   <TR><TD>Reviewers:     </TD><TD> &nbsp;                       </TD></TR>
   <TR><TD>Revision:      </TD><TD> $Revision$             </TD></TR>
   <TR><TD>Release Name:  </TD><TD> $Name$                       </TD></TR>
   <TR><TD>Change Date:   </TD><TD> $Date$ </TD></TR>
   <TR><TD>Change history:</TD><TD> see CVS log                  </TD></TR>
</TABLE>

<!--==================================================================-->

<A NAME="OVERVIEW"></A>
<HR>
<H2>OVERVIEW</H2>
Provides an abstraction of the definition of an observation. An observation
sequence at a higher level is composed of observation definitions associated
with observed values. For now, the basic operations required to implement an
observation definition are an ability to compute a forward operator given the
model state vector, the ability to read/write the observation definition from/to
a file, and a capability to do a standard input driven interactive definition
of the observation definition.
<P>
Beginning with the I-release of DART, a more flexible. powerful (and complicated)
mechanism for incorporating new types of observations is part of DART. The
obs_def module being described here is created by the program preprocess.f90
from two kinds of input files. First, a DEFAULT obs_def module (normally called
DEFAULT_obs_def_mod.F90 and documented in this directory) is used as a template
into which the preprocessor incorporates information from zero or more special
obs_def modules (such as obs_def_1d_state_mod.f90 or obs_def_reanalyis_bufr_mod.f90)
which are also documented in this directory. If no special obs_def files are 
included in the preprocessor namelist, a minimal obs_def_mod.f90 is created which
can only support identity forward observation operators.
</P>

<!--==================================================================-->

<A NAME="OTHER MODULES USED"></A>
<BR><HR>
<H2>OTHER MODULES USED</H2>
<PRE>
types_mod
utilities_mod
location_mod (depends on model choice)
time_manager_mod
assim_model_mod
obs_kind_mod
Other special obs_def_kind modules as required
</PRE>

<!--==================================================================-->
<!--Note to authors. The first row of the table is different.         -->

<A NAME="Interface"></A>
<BR><HR>
<H2>PUBLIC INTERFACE</H2>

<TABLE>
<TR><TD><em class=call>use obs_def_mod, only : </em></TD>
                   <TD><A HREF="#yyypubtype1">obs_def_type</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#init_obs_def">init_obs_def</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#get_obs_def_location">get_obs_def_location</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#get_obs_kind">get_obs_kind</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#get_obs_def_time">get_obs_def_time</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#get_obs_def_error_variance">get_obs_def_error_variance</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#get_obs_def_key">get_obs_def_key</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#set_obs_def_location">set_obs_def_location</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#set_obs_def_kind">set_obs_def_kind</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#set_obs_def_time">set_obs_def_time</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#set_obs_def_error_variance">set_obs_def_error_variance</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#set_obs_def_key">set_obs_def_key</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#interactive_obs_def">interactive_obs_def</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#write_obs_def">write_obs_def</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#read_obs_def">read_obs_def</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#get_expected_obs_from_def">get_expected_obs_from_def</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#destroy_obs_def">destroy_obs_def</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#copy_obs_def">copy_obs_def</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#copy_obs_def">assignment(=)</A></TD></TR>
<TR><TD>&nbsp;</TD><TD><A HREF="#get_obs_name">get_obs_name</A></TD></TR>
</TABLE>

<BR>

<!--==================================================================-->
<!-- Declare all public entities ...                                  -->
<!-- duplicate public routines template as many times as necessary    -->
<!-- make sure you replace all yyyroutine?? strings                   -->
<!--==================================================================-->

<A NAME="PublicEntities"></A>
<BR><HR>
<H2>PUBLIC COMPONENTS</H2>
The following types, functions, and subroutines are public.
<BR>

<!--=================== DESCRIPTION OF A LOCAL TYPE ==================-->

<A NAME="yyypubtype1"></A>
<BR><HR><BR>
<div class=type><pre>
<em class=call>type obs_def_type</em>
   private
   type(location_type)  :: location
   integer              :: kind
   type(time_type)      :: time
   real(r8)             :: error_variance
   integer              :: key
end type obs_def_type
</pre></div>

<H3 class=indent1>Description</H3>

<P>
Models all that is known about an observation except for actual values.
Includes a location, kind, time and error variance.
</P>

<TABLE border=0 cellpadding=3 width=100%>
<TR><TH align=left>Component   </TH>
    <TH align=left>Description </TH></TR>
<TR><TD valign=top> location              </TD>
    <TD>Location of the observation.      </TD></TR>
<TR><TD valign=top> kind                  </TD>
    <TD>The kind of the observation.      </TD></TR>
<TR><TD valign=top> time                  </TD>
    <TD>Time of the observation.          </TD></TR>
<TR><TD valign=top> error_variance        </TD>
    <TD>Error variance of the observation.</TD></TR>
<TR><TD valign=top> key                   </TD>
    <TD>Unique identifier for observations of a particular kind.</TD></TR>
</TABLE>

<!--=================== DESCRIPTION OF A LOCAL TYPE ==================-->

<!--============= DESCRIPTION OF A SUBROUTINE =======================-->

<A NAME="init_obs_def"></A>
 <BR><HR><BR>
 <div class=routine>
 <em class=call> call init_obs_def(obs_def, location, kind, time, error_variance) </em>
 <pre>
 type(obs_def_type),  intent(out) :: <em class=code>obs_def</em>
 type(location_type), intent(in)  :: <em class=code>location</em>
 integer,             intent(in)  :: <em class=code>kind</em>
 type(time_type),     intent(in)  :: <em class=code>time</em>
 real(r8),            intent(in)  :: <em class=code>error_variance</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Creates an obs_def type with location, kind, time and error_variance
specified. 
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>obs_def&nbsp; &nbsp; </em></TD>
     <TD>The obs_def that is created</TD></TR>
 <TR><TD valign=top><em class=code>location&nbsp; &nbsp; </em></TD>
     <TD>Location for this obs_def</TD></TR>
 <TR><TD valign=top><em class=code>kind&nbsp; &nbsp; </em></TD>
     <TD>Observation kind for obs_def</TD></TR>
 <TR><TD valign=top><em class=code>time&nbsp; &nbsp; </em></TD>
     <TD>Time for obs_def</TD></TR>
 <TR><TD valign=top><em class=code>error_variance&nbsp; &nbsp; </em></TD>
     <TD>Error variance of this observation</TD></TR>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A SUBROUTINE =======================-->

<A NAME="copy_obs_def"></A>
 <BR><HR><BR>
 <div class=routine>
 <em class=call> call copy_obs_def(obs_def1, obs_def2) </em>
 <pre>
 type(obs_def_type), intent(out) :: <em class=code>obs_def1</em>
 type(obs_def_type), intent(in)  :: <em class=code>obs_def2</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Copies obs_def2 to obs_def1, overloaded as assignment (=).
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>obs_def1&nbsp; &nbsp; </em></TD>
     <TD>obs_def to be copied into</TD></TR>
 <TR><TD valign=top><em class=code>obs_def2&nbsp; &nbsp; </em></TD>
     <TD>obs_def to be copied from</TD></TR>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A FUNCTION ========================-->
<A NAME="get_obs_def_key"></A>
<BR><HR><BR>
 <div class=routine>
 <em class=call> var = get_obs_def_key(obs_def) </em>
 <pre>
 integer                        :: <em class=code>get_obs_def_key</em>
 type(obs_def_type), intent(in) :: <em class=code>obs_def</em>
 </pre>
</div>
 <H3 class=indent1>Description</H3>
 <P>
Returns key from an observation definition.
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>var&nbsp; &nbsp; </em></TD>
     <TD>Returns key from an obs_def</TD></TR>
 <TR><TD valign=top><em class=code>obs_def&nbsp; &nbsp; </em></TD>
     <TD>An obs_def</TD></TR>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A FUNCTION ========================-->

<A NAME="get_obs_def_error_variance"></A>
 <BR><HR><BR>
 <div class=routine>
 <em class=call> var = get_obs_def_error_variance(obs_def) </em>
 <pre>
 real(r8)                       :: <em class=code>get_obs_def_error_variance</em>
 type(obs_def_type), intent(in) :: <em class=code>obs_def</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Returns error variance from an observation definition.
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>var&nbsp; &nbsp; </em>
 </TD>
     <TD>Error variance from an obs_def</TD></TR>
 <TR><TD valign=top><em class=code>obs_def&nbsp; &nbsp; </em></TD>
     <TD>An obs_def</TD></TR>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A FUNCTION ========================-->

<A NAME="get_obs_def_location"></A>
 <P></P><HR><P></P>
 <div class=routine>
 <em class=call> var = get_obs_def_location(obs_def) </em>
 <pre>
 type(location_type)              :: <em class=code>get_obs_def_location</em>
 type(obs_def_type), intent(in)   :: <em class=code>obs_def</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Returns the location from an observation definition. 
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>var&nbsp; &nbsp; </em></TD>
     <TD>Returns location from an obs_def</TD></TR>
 <TR><TD valign=top><em class=code>obs_def&nbsp; &nbsp; </em></TD>
     <TD>An obs_def</TD></TR>
 </TABLE>
 <BR>


<!--============= DESCRIPTION OF A FUNCTION ========================-->
<A NAME="get_obs_kind"></A>
 <P></P><HR><P></P>
 <div class=routine>
 <em class=call> var = get_obs_kind(obs_def) </em>
 <pre>
 integer                         :: <em class=code>get_obs_kind</em>
 type(obs_def_type),  intent(in) :: <em class=code>obs_def</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
 Returns an observation kind from an observation definition.
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>var&nbsp; &nbsp; </em></TD>
     <TD>Returns the observation kind from an obs_def</TD></TR>
 <TR><TD valign=top><em class=code>obs_def&nbsp; &nbsp; </em></TD>
     <TD>An obs_def</TD></TR>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A FUNCTION ========================-->
<A NAME="get_obs_def_time"></A>
 <P></P><HR><P></P>
 <div class=routine>
 <em class=call> var = get_obs_def_time(obs_def) </em>
 <pre>
 type(time_type)                :: <em class=code>get_obs_def_time</em>
 type(obs_def_type), intent(in) :: <em class=code>obs_def</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Returns time from an observation definition.
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>var&nbsp; &nbsp; </em></TD>
     <TD>Returns time from an obs_def</TD></TR>
 <TR><TD valign=top><em class=code>obs_def&nbsp; &nbsp; </em></TD>
     <TD>An obs_def</TD></TR>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A FUNCTION ========================-->
<A NAME="get_obs_name"></A>
<BR><HR><BR>
 <div class=routine>
 <em class=call> obs_name = get_obs_name(obs_kind_ind) </em>
 <pre>
 character(len = 32)            :: <em class=code>get_obs_name</em>
 integer, intent(in)            :: <em class=code>obs_kind_ind</em>
 </pre>
</div>
 <H3 class=indent1>Description</H3>
 <P>
Returns an observation name from an observation kind.
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>var&nbsp; &nbsp; </em></TD>
     <TD>Returns name from an observation kind</TD></TR>
 <TR><TD valign=top><em class=code>obs_kind_ind&nbsp; &nbsp; </em></TD>
     <TD>An observation kind</TD></TR>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A SUBROUTINE =======================-->
<A NAME="set_obs_def_location"></A>
 <BR><HR><BR>
 <div class=routine>
 <em class=call> call set_obs_def_location(obs_def, location) </em>
 <pre>
 type(obs_def_type),  intent(inout) :: <em class=code>obs_def</em>
 type(location_type), intent(in)    :: <em class=code>location</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Set the location in an observation definition.
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>obs_def&nbsp; &nbsp; </em></TD>
     <TD>An obs_def</TD></TR>
 <TR><TD valign=top><em class=code>location&nbsp; &nbsp; </em></TD>
     <TD>A location</TD></TR>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A SUBROUTINE =======================-->
<A NAME="set_obs_def_error_variance"></A>
 <BR><HR><BR>
 <div class=routine>
 <em class=call> call set_obs_def_error_variance(obs_def, error_variance) </em>
 <pre>
 type(obs_def_type), intent(inout) :: <em class=code>obs_def</em>
 real(r8), intent(in)              :: <em class=code>error_variance</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Set error variance for an observation definition.
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>obs_def&nbsp; &nbsp; </em></TD>
     <TD>An obs_def</TD></TR>
 <TR><TD valign=top><em class=code>error_variance&nbsp; &nbsp; </em></TD>
     <TD>Error variance</TD></TR>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A SUBROUTINE =======================-->
<A NAME="set_obs_def_key"></A>
 <BR><HR><BR>
 <div class=routine>
 <em class=call> call set_obs_def_key(obs_def, key) </em>
 <pre>
 type(obs_def_type), intent(inout) :: <em class=code>obs_def</em>
 integer,            intent(in)    :: <em class=code>key</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Set the key for an observation definition.
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>obs_def&nbsp; &nbsp; </em></TD>
     <TD>An obs_def</TD></TR>
 <TR><TD valign=top><em class=code>key&nbsp; &nbsp; </em></TD>
     <TD>Unique identifier for this observation</TD></TR>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A SUBROUTINE =======================-->
<A NAME="set_obs_def_kind"></A>
 <BR><HR><BR>
 <div class=routine>
 <em class=call> call set_obs_def_kind(obs_def, kind) </em>
 <pre>
 type(obs_def_type), intent(inout) :: <em class=code>obs_def</em>
 integer,            intent(in)    :: <em class=code>kind</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Set the kind of observation in an observation definition.
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>obs_def&nbsp; &nbsp; </em></TD>
     <TD>An obs_def</TD></TR>
 <TR><TD valign=top><em class=code>kind&nbsp; &nbsp; </em></TD>
     <TD>An integer observation kind</TD></TR>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A SUBROUTINE =======================-->
<A NAME="set_obs_def_time"></A>
 <BR><HR><BR>
 <div class=routine>
 <em class=call> call set_obs_def_time(obs_def, time) </em>
 <pre>
 type(obs_def_type), intent(inout) :: <em class=code>obs_def</em>
 type(time_type), intent(in)       :: <em class=code>time</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Sets time for an observation definition.
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>obs_def&nbsp; &nbsp; </em></TD>
     <TD>An obs_def</TD></TR>
 <TR><TD valign=top><em class=code>time&nbsp; &nbsp; </em></TD>
     <TD>Time to set</TD></TR>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A SUBROUTINE =======================-->
<A NAME="get_expected_obs_from_def"></A>
 <BR><HR><BR>
 <div class=routine>
 <em class=call> call get_expected_obs_from_def(key, obs_def, obs_kind_ind,
   state, obs_val, istatus, assimilate_this_ob, evaluate_this_ob) </em>
 <pre>
 integer,            intent(in)  :: <em class=code>key</em>
 type(obs_def_type), intent(in)  :: <em class=code>obs_def</em>
 integer,            intent(in)  :: <em class=code>obs_kind_ind</em>
 real(r8),           intent(in)  :: <em class=code>state(:)</em>
 real(r8),           intent(out) :: <em class=code>obs_val</em>
 integer,            intent(out) :: <em class=code>istatus</em>
 logical,            intent(out) :: <em class=code>assimilate_this_ob</em>
 logical,            intent(out) :: <em class=code>evaluate_this_ob</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Compute the observation (forward) operator for a particular obs definition.
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>key&nbsp; &nbsp; </em></TD>
     <TD>descriptor for observation type</TD></TR>
 <TR><TD valign=top><em class=code>obs_def&nbsp; &nbsp; </em></TD>
     <TD>The input obs_def</TD></TR>
 <TR><TD valign=top><em class=code>obs_kind_ind&nbsp; &nbsp; </em></TD>
     <TD>The obs kind</TD></TR>
 <TR><TD valign=top><em class=code>state&nbsp; &nbsp; </em></TD>
     <TD>Model state vector</TD></TR>
 <TR><TD valign=top><em class=code>istatus&nbsp; &nbsp; </em></TD>
     <TD>Returned integer describing problems with applying 
		  forward operator (0 means OK).</TD></TR>
 <TR><TD valign=top><em class=code>assimilate_this_ob&nbsp; &nbsp; </em></TD>
     <TD>Indicates whether to assimilate this obs or not</TD></TR>
 <TR><TD valign=top><em class=code>evaluate_this_ob&nbsp; &nbsp; </em></TD>
     <TD>Indicates whether to evaluate this obs or not</TD></TR>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A SUBROUTINE =======================-->
<A NAME="read_obs_def"></A>
 <BR><HR><BR>
 <div class=routine>
 <em class=call> call read_obs_def(ifile, obs_def, key, obs_val
     <em class=optionalcode>[,fform]</em>) </em>
 <pre>
 integer,                    intent(in)    :: <em class=code>ifile</em>
 type(obs_def_type),         intent(inout) :: <em class=code>obs_def</em>
 integer,                    intent(in)    :: <em class=code>key</em>
 real(r8),                   intent(inout) :: <em class=code>obs_val</em>
 character(len=*), optional, intent(in)    :: <em class=code>fform</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Reads an obs_def from file open on channel ifile. Uses format specified
in fform or FORMATTED if fform is not present. 
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>ifile&nbsp; &nbsp; </em></TD>
     <TD>File unit open to output file</TD></TR>
 <TR><TD valign=top><em class=code>obs_def&nbsp; &nbsp; </em></TD>
     <TD>Observation definition to be read</TD></TR>
 <TR><TD valign=top><em class=code>key&nbsp; &nbsp; </em></TD>
     <TD>Present if unique identifier key is needed by some obs kind.  
         Unused by default code.</TD></TR>
 <TR><TD valign=top><em class=code>obs_val&nbsp; &nbsp; </em></TD>
     <TD>Present if needed to perform operations based on value.
         Unused by default code.</TD></TR>
 <TR><TD valign=top><em class=code>fform&nbsp; &nbsp; </em></TD>
     <TD>File format specifier: FORMATTED or UNFORMATTED; default FORMATTED
          (FORMATTED in this case is the human readable/text 
           option as opposed to UNFORMATTED which is binary.)</TD></TR>
 </TABLE>
 <BR>


<!--============= DESCRIPTION OF A SUBROUTINE =======================-->
<A NAME="interactive_obs_def"></A>
 <P></P><HR><P></P>
 <div class=routine>
 <em class=call> call interactive_obs_def(obs_def, key) </em>
 <pre>
 type(obs_def_type), intent(inout) :: <em class=code>obs_def</em>
 integer,            intent(in)    :: <em class=code>key</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Creates an obs_def via input from standard in. 
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>obs_def&nbsp; &nbsp; </em></TD>
     <TD>An obs_def to be created</TD></TR>
 <TR><TD valign=top><em class=code>key&nbsp; &nbsp; </em></TD>
     <TD>Present if unique identifier key is needed by some obs kind.
         Unused by default code.</TD></TR>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A SUBROUTINE =======================-->
<A NAME="write_obs_def"></A>
 <P></P><HR><P></P>
 <div class=routine>
 <em class=call> call write_obs_def(ifile, obs_def, key
     <em class=optionalcode>[,fform]</em>) </em>
 <pre>
 integer,                    intent(in) :: <em class=code>ifile</em>
 type(obs_def_type),         intent(in) :: <em class=code>obs_def</em>
 integer,                    intent(in) :: <em class=code>key</em>
 character(len=*), optional, intent(in) :: <em class=code>fform</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Writes an obs_def to file open on channel ifile. Uses format specified
in fform or FORMATTED if fform is not present. 
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>ifile&nbsp; &nbsp; </em></TD>
     <TD>File unit open to output file</TD></TR>
 <TR><TD valign=top><em class=code>obs_def&nbsp; &nbsp; </em></TD>
     <TD>Observation definition to be written</TD></TR>
 <TR><TD valign=top><em class=code>key&nbsp; &nbsp; </em></TD>
     <TD>Present if unique identifier key is needed by some obs kind.
         Unused by default code.</TD></TR>
 <TR><TD valign=top><em class=code>fform&nbsp; &nbsp; </em></TD>
     <TD>File format specifier: FORMATTED or UNFORMATTED; default FORMATTED</TD>
 </TR>
 </TABLE>
 <BR>

<!--============= DESCRIPTION OF A SUBROUTINE =======================-->
<A NAME="destroy_obs_def"></A>
 <P></P><HR><P></P>
 <div class=routine>
 <em class=call> call destroy_obs_def(obs_def) </em>
 <pre>
 type(obs_def_type), intent(inout) :: <em class=code>obs_def</em>
 </pre></div>
 <H3 class=indent1>Description</H3>
 <P>
Releases all storage associated with an obs_def and its subcomponents. 
 </P>
 <TABLE width=100% border=0 summary="" celpadding=3>
 <TR><TD valign=top><em class=code>obs_def&nbsp; &nbsp; </em></TD>
     <TD>An obs_def to be released.</TD></TR>
 </TABLE>
 <BR>


<!--==================================================================-->
<!-- Describe the Files Used by this module.                          -->
<!--==================================================================-->
</P>
<A NAME="FilesUsed"></A>
<BR><HR>
<H2>FILES</H2>
<UL><LI>The read_obs_def() and write_obs_def() routines 
are passed an already-opened file channel/descriptor
and read to or write from it.
</UL>

<!--==================================================================-->
<!-- Cite references, if need be.                                     -->
<!--==================================================================-->

<A NAME="References"></A>
<BR><HR>
<H2>REFERENCES</H2>

<!--==================================================================-->
<!-- Describe all the error conditions and codes.                     -->
<!-- Putting a <BR> after the synopsis creates a nice effect.         -->
<!--==================================================================-->

<A NAME="Errors"></A>
<HR>
<H2>ERROR CODES and CONDITIONS</H2>
<div class="errors">
<TABLE border=1 cellspacing=1 cellpadding=10 width=100%>
<TR><TH>Routine</TH><TH>Message</TH><TH>Comment</TH></TR>

<TR><!-- routine --><TD VALIGN=top>get_expected_obs_from_def</TD>
    <!-- message --><TD VALIGN=top>Attempt to evaluate undefined observation kind</TD>
    <!-- comment --><TD VALIGN=top>An observation kind for which
     no forward operator has been defined is an error.</TD>
</TR>

<TR><!-- routine --><TD VALIGN=top>read_obs_def</TD>
    <!-- message --><TD VALIGN=top>Expected header "obdef" in input file</TD>
    <!-- comment --><TD VALIGN=top>The format of the input file is not consistent.</TD>
</TR>

<TR><!-- routine --><TD VALIGN=top>read_obs_def</TD>
    <!-- message --><TD VALIGN=top>Expected kind header "kind " in input file</TD>
    <!-- comment --><TD VALIGN=top>The format of the input file is not consistent.</TD>
</TR>

<TR><!-- routine --><TD VALIGN=top>read_obs_def</TD>
    <!-- message --><TD VALIGN=top>Attempt to read for undefined obs_kind index</TD>
    <!-- comment --><TD VALIGN=top>Reading for an observation kind for which
     no forward operator has been defined is an error.</TD>
</TR>

<TR><!-- routine --><TD VALIGN=top>write_obs_def</TD>
    <!-- message --><TD VALIGN=top>Attempt to write for undefined obs_kind index</TD>
    <!-- comment --><TD VALIGN=top>Writing for an observation kind for which
     no forward operator has been defined is an error.</TD>
</TR>

<TR><!-- routine --><TD VALIGN=top>interactive_obs_def</TD>
    <!-- message --><TD VALIGN=top>Attempt to  interactively create undefined obs_kind index</TD>
    <!-- comment --><TD VALIGN=top>Creating an observation kind for which
     no forward operator has been defined is an error.</TD>
</TR>

</TABLE>
</div>

<!--==================================================================-->
<!-- Describe the bugs.                                               -->
<!--==================================================================-->

<A NAME="KnownBugs"></A>
<BR><HR>
<H2>KNOWN BUGS</H2>
<P>
</P>

<!--==================================================================-->
<!-- Describe Future Plans.                                            -->
<!--==================================================================-->

<A NAME="FuturePlans"></A>
<BR><HR>
<H2>FUTURE PLANS</H2>
<P>
</P>

<!--==================================================================-->

<HR>
</BODY>
</HTML>
