<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
          "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
<HEAD>
<TITLE>program SMAP_L2_to_obs</TITLE>
<link rel="stylesheet" type="text/css" href="../../../documentation/html/doc.css" />
<link href="../../../documentation/images/dart.ico" rel="shortcut icon" />
</HEAD>
<BODY>
<A NAME="TOP"></A>

<H1>PROGRAM <em class=program>SMAP_L2_to_obs</em></H1>

<table border=0 summary="" cellpadding=5>
<tr>
    <td valign=middle>
    <img src="../../../documentation/images/Dartboard7.png" alt="DART project logo" height=70 />
    </td>
    <td>
       <P>Jump to <a href="../../../documentation/index.html">DART Documentation Main Index</a><br />
          <small><small>version information for this file: <br />
          <!-- version tag follows, do not edit -->
          $Id$</small></small>
       </P></td>
</tr>
</table>

<A HREF="#Namelist">NAMELIST</A> /
<A HREF="#DataSources">DATA SOURCES</A> /
<A HREF="#Programs">PROGRAMS</A> /
<A HREF="#Decisions">DECISIONS</A> /
<A HREF="#References">REFERENCES</A> /
<A HREF="#Errors">ERRORS</A> /
<A HREF="#FuturePlans">PLANS</A> / 
<A HREF="#Legalese">TERMS OF USE</A>

<H1>Overview</H1>

<H2>Soil Moisture Active Passive (SMAP) passive microwave radiometer<br />
    to DART Observation Sequence Converter</H2>

<P>This routine is designed to convert the
<a href="https://nsidc.org/data/SPL2SMP/versions/4">SMAP L2 Radiometer Half-Orbit 36 km EASE-Grid Soil Moisture, Version 4</a> soil moisture product to a DART observation sequence file.
<br />
<br />
Quoting the <a href="http://nsidc.org">NSIDC</a>:
</P>
<blockquote><em class=italic>
This Level-2 (L2) soil moisture product provides estimates of global land 
surface conditions retrieved by the Soil Moisture Active Passive (SMAP) 
passive microwave radiometer during 6:00 a.m. descending and 6:00 p.m. 
ascending half-orbit passes. SMAP L-band brightness temperatures are used  to
derive soil moisture data, which are then resampled to an Earth-fixed, global,
cylindrical 36 km Equal-Area Scalable Earth Grid, Version 2.0 (EASE-Grid 2.0).
<br />
<br />
Data Set ID: SPL2SMP
<br />
SMAP L2 Radiometer Half-Orbit 36 km EASE-Grid Soil Moisture, Version 4
<br />
<br />
Surface soil moisture (0-5 cm) in m3/m3 derived from brightness temperatures
(TBs) is output on a fixed global 36 km EASE-Grid 2.0. Also included are 
brightness temperatures in kelvin representing the weighted average of 
Level-1B brightness temperatures whose boresights fall within a 36 km 
EASE-Grid 2.0 cell.</em>
</blockquote>
<P>
<strong>Important</strong>: <em class=program>SMAP_L2_to_obs</em> uses an
observation error standard deviation of 0.01 m3/m3 or 20% of the soil moisture 
value, whatever is higher. <strong>These numbers have no scientific basis and 
should be thoroughly explored.</strong>  The data files I have explored have 
a variable <em class=code>soil_moisture_error</em> but these appear to be 
empty - i.e. full of <em class=code>_FillValue</em> values. A better way
of specifying the observation error standard deviation is needed.
<br />
<br />
<strong>Important</strong>: <em class=program>SMAP_L2_to_obs</em> has only
been thoroughly tested with the half-orbit files - these files have names like<br />
<em class=file>SMAP_L2_SM_P_02526_D_20150723T070211_R12170_001.h5</em>. 
</P>

<P>
The workflow is usually: 
</P>
<ol>
<li>download the data for the period in question 
    (<a href="#DataSources">see DATA SOURCES below</a>)
<li>build the DART executables with support for the soil moisture observations.
    This is done by running <em class=program>preprocess</em> with 
    <em class=file>obs_def_land_mod.f90</em> in the list of <em class=code>input_files</em>
    for <em class=code>preprocess_nml</em>.
<li>convert each data file individually using <em class=program>SMAP_L2_to_obs</em></li>
<li>combine or subset all output files for the region and timeframe of interest into one file 
    using <a href="../../obs_sequence/obs_sequence_tool.html ">obs_sequence_tool</a></li>
</ol>

<P>
For some models (CLM, for example), it is required to reorganize the observation sequence
files into a series of files that contains ONLY the observations for each assimilation.
This can be achieved with the <a href="../../models/clm/shell_scripts/makedaily.sh">makedaily.sh</a>
script. Since there are subtleties for each model, 
<em class=program>makedaily.sh</em> is generally found in the
<em class=file>shell_scripts</em> directory of the model.
</P>

<!--==================================================================-->
<!--=================== DESCRIPTION OF A NAMELIST  ===================-->
<!--==================================================================-->

<A NAME="Namelist"></A>
<div class="top">[<a href="#">top</a>]</div><hr />
<H2>NAMELIST</H2>
<P>
This namelist is read from the file <em class=file>input.nml</em>.
Namelists start with an ampersand
'&amp;' and terminate with a slash '/'.
Character strings that contain a '/' must be
enclosed in quotes to prevent them from
prematurely terminating the namelist.
</P>

<div class=namelist>
<pre>
&amp;SMAP_L2_to_obs_nml
   input_file_list     = 'file_list.txt'
   obs_out_file        = 'obs_seq.out'
   max_num_input_files = 10
   verbose             = .false.
   /
</pre>
</div>

<div>

<TABLE border=0 cellspacing=10 width=100% summary='SMAP_L2_to_obs namelist description'>
<THEAD align=left>
<TR><TH>Contents    </TH>
    <TH>Type        </TH>
    <TH>Description </TH></TR>
</THEAD>

<TBODY valign=top>
<TR><!--contents--><TD> input_file_list  </TD>
    <!--  type  --><TD> character(len=256) </TD>
    <!--descript--><TD>Name of the file containing the list of input data files.
            Each input data file name must be on a separate line. No blank lines
            are allowed. This may be a relative or absolute filename. </TD></TR>

<TR><!--contents--><TD> obs_out_file  </TD>
    <!--  type  --><TD> character(len=256) </TD>
    <!--descript--><TD>Name of the output observation sequence file.</TD></TR>

<TR><!--contents--><TD> max_num_input_files </TD>
    <!--  type  --><TD> integer </TD>
    <!--descript--><TD> The maximum number of filenames in <em class=code>input_file_list</em> 
            to convert. This should be a small number - converting all frequencies, all
            polarizations, both passes into one file is generally not a smart thing to do.
                </TD></TR>

<TR><!--contents--><TD> verbose   </TD>
    <!--  type  --><TD> logical   </TD>
    <!--descript--><TD>Print extra information during the <em class=program>SMAP_L2_to_obs</em> 
            execution.</TD></TR>

</TBODY>
</TABLE>

</div>

<P><!-- do-nothing spacer so 'top' lines up correctly --></P>
<!--==================================================================-->
<A NAME="DataSources"></A>
<div class="top">[<a href="#">top</a>]</div><hr />
<H2>DATA SOURCES</H2>

<P>
The SMAP L2 Radiometer Half-Orbit 36 km EASE-Grid Soil Moisture, Version 4 data are available at
<a href="https://nsidc.org/data/SPL2SMP/versions/4">http://nsidc.org/data/nsidc-0301.html</a>
</P>

<H3>Data Citation</H3>

<P>
The following example shows how to cite the use of this data set in a publication.
For more information, see the 
<a href="http://nsidc.org/about/use_copyright.html">Use and Copyright</a> web page.
<blockquote>
O'Neill, P. E., S. Chan, E. G. Njoku, T. Jackson, and R. Bindlish. 2016.<br /> 
SMAP L2 Radiometer Half-Orbit 36 km EASE-Grid Soil Moisture, Version 4. 
[Indicate subset used].<br /> 
Boulder, Colorado USA. NASA National Snow and Ice Data Center Distributed Active Archive Center.<br />
doi: http://dx.doi.org/10.5067/XPJTJT812XFY. [Date Accessed].
</blockquote>
</P>

<!--==================================================================-->

<A NAME="Programs"></A>
<div class="top">[<a href="#">top</a>]</div><hr />
<H2>PROGRAMS</H2>
<P>
The <em class=file>SMAP_L2_to_obs.f90</em> file is the source
for the converter program.
<br />
To compile and test,
go into the work subdirectory and run the <em class=file>quickbuild.csh</em>
script to build the converter and a couple of general purpose utilities.
<a href="../../time_manager/advance_time.html">advance_time</a> helps 
with calendar and time computations, and the
<a href="../../obs_sequence/obs_sequence_tool.html">obs_sequence_tool</a>
manipulates DART observation files once they have been created.
</P>

<!--==================================================================-->

<A NAME="Decisions"></A>
<div class="top">[<a href="#">top</a>]</div><hr />
<H2>DECISIONS YOU MIGHT NEED TO MAKE</H2>

<P>
See the discussion in the
<a href="../observations.html#Decisions">observations introduction</a> 
page about what options are available for the things you need to
specify.  These include setting a time, specifying an expected error,
setting a location, and an observation type.
</P>

<!--==================================================================-->
<!-- Describe the bugs.                                               -->
<!--==================================================================-->

<A NAME="KnownBugs"></A>
<div class="top">[<a href="#">top</a>]</div><hr />
<H2>KNOWN BUGS</H2>
<P>
There are no known bugs.
</P>

<!--==================================================================-->
<!-- Describe Future Plans.                                           -->
<!--==================================================================-->

<A NAME="FuturePlans"></A>
<div class="top">[<a href="#">top</a>]</div><hr />
<H2>FUTURE PLANS</H2>
<P>
none
</P>

<!--==================================================================-->
<!-- Legalese & Metadata                                              -->
<!--==================================================================-->

<A NAME="Legalese"></A>
<div class="top">[<a href="#">top</a>]</div><hr />
<H2>Terms of Use</H2>

<P>
DART software - Copyright UCAR. This open source software is provided
by UCAR, "as is", without charge, subject to all terms of use at
<a href="http://www.image.ucar.edu/DAReS/DART/DART_download">
http://www.image.ucar.edu/DAReS/DART/DART_download</a>
</P>

<TABLE border=0 cellpadding=0 width=100% summary="">
<TR><TD valign=top>Contact:       </TD><TD> DART core group   </TD></TR>
<TR><TD valign=top>Revision:      </TD><TD> $Revision$ </TD></TR>
<TR><TD valign=top>Source:        </TD><TD> $URL$ </TD></TR>
<TR><TD valign=top>Change Date:   </TD><TD> $Date$ </TD></TR>
<TR><TD valign=top>Change&nbsp;history:&nbsp;</TD><TD> try "svn&nbsp;log" or "svn&nbsp;diff" </TD></TR>
</TABLE>

<!--==================================================================-->

</BODY>
</HTML>
