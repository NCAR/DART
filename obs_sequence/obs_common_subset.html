<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
          "http://www.w3.org/TR/html4/strict.dtd">
<HTML>
<HEAD>
<TITLE>PROGRAM obs_common_subset</TITLE>
<link rel="stylesheet" type="text/css" href="../doc/html/doc.css" />
<link href="../doc/html/dart.ico" rel="shortcut icon" />
</HEAD>
<BODY>
<A NAME="TOP"></A>

<H1>PROGRAM <em class=program>obs_common_subset</em></H1>

<table border=0 summary="" cellpadding=5>
<tr>
    <td valign=middle>
    <img src="../doc/html/Dartboard9.png" alt="DART project logo" height=70 />
    </td>
    <td>
       <P>Jump to <a href="../index.html">DART Documentation Main Index</a><br />
          <small><small>version information for this file: <br />
          <!-- version tag follows, do not edit -->
          $Id$</small></small>
       </P></td>
</tr>
</table>

<A HREF="#Namelist">NAMELIST</A> /
<A HREF="#Building">BUILDING</A> /
<A HREF="#FilesUsed">FILES</A> /
<A HREF="#References">REFERENCES</A> /
<A HREF="#Errors">ERRORS</A> /
<A HREF="#FuturePlans">PLANS</A> /
<A HREF="#Legalese">TERMS OF USE</A>

<H2>Overview</H2>

<P>
This specialized tool takes a list of pairs of input observation sequence 
files and outputs a new set of pairs of observation sequence files in 
which only the observations which were successfully assimilated in both 
files are kept.
The expected use of this tool is for comparing different assimilation
runs which use the same input observation sequence file as input.
If different numbers of observations are assimilated in two different
experiments they will cause differences in the diagnostic plots
which are not directly relatable to the differences in the quality
of the assimilation.  After a pair of experimental runs, if this tool is
run on the obs_seq.final files and then the diagnostics are generated
only the observations which were assimilated in both experiments will
contribute to the summary statistics.  A more direct comparison can be
made and improvements attributed to the differences in the experimental 
parameters.
</P><P>
See the <a href="http://www.image.ucar.edu/DAReS/DART/DART_Documentation.php#obs_diagnostics">
two experiment diagnostic plot</a> documentation for Matlab scripts
supplied with DART to directly compare the observation diagnostic output
from two experiments.
</P><P>
The actions of the <em class=code>obs_common_subset</em> program
are controlled by a Fortran namelist, read from a file named
<em class=file>input.nml</em> in the current directory.  A detailed
description of each namelist item is described in the
<a href="#Namelist">namelist section</a> of this document.
The names used in this discussion refer to these namelist items.
</P><P>
This is one of a set of tools which operate on observation sequence files.
For a more general purpose tool, see the 
<a href="obs_sequence_tool.hmtl">obs_sequence_tool</a>.
</P>

<!--==================================================================-->
<!--=================== DESCRIPTION OF A NAMELIST ====================-->
<!--==================================================================-->

<A NAME="Namelist"></A>
<HR>
<H2>NAMELIST</H2>
<P>We adhere to the F90 standard of starting a namelist with an ampersand
'&amp;' and terminating with a slash '/' for all our namelist input.
</P>
<div class=namelist>
<pre>
<em class=call>namelist / obs_common_subset_nml / </em> 
 filename_seq1, filename_seq_list1, filename_seq2, filename_seq_list2,
 filename_out_suffix, print_only, calendar
</pre>
</div>

<div class=indent1><!-- Description -->

<P>
This <em class=code>&amp;obs_common_subset</em> namelist is read from 
the <em class=file>input.nml</em> file.
</P>

<TABLE border=0 cellpadding=3 width=100%>
<TR><TH align=left>Contents    </TH>
    <TH align=left>Type        </TH>
    <TH align=left>Description </TH></TR>
<TR><!--contents--><TD valign=top>filename_seq1</TD>
    <!--  type  --><TD>character(len=129), dimension(500)</TD>
    <!--descript--><TD>The array of names of the observation sequence 
                       files to process.  This list is the first of the
                       set of corresponding pairs.
                       Default: ''</TD></TR>
<TR><!--contents--><TD valign=top>filename_seq_list1</TD>
    <!--  type  --><TD>character(len=129)</TD>
    <!--descript--><TD>An alternative way to specify one or more input
                       observation sequence files. 
                       The name of a text file which contains, one per line,
                       the names of the observation sequence files to process.
                       You can only specify one of filename_seq1 OR 
                       filename_seq_list1, not both.
                       Default: ''</TD></TR>
<TR><!--contents--><TD valign=top>filename_seq2</TD>
    <!--  type  --><TD>character(len=129), dimension(500)</TD>
    <!--descript--><TD>The array of names of the corresponding 
                       observation sequence files to process.  This list is the
                       second of the set of corresponding pairs.
                       Default: ''</TD></TR>
<TR><!--contents--><TD valign=top>filename_seq_list2</TD>
    <!--  type  --><TD>character(len=129)</TD>
    <!--descript--><TD>An alternative way to specify one or more input
                       observation sequence files. 
                       The name of a text file which contains, one per line,
                       observation sequence files to process.
                       You can only specify one of filename_seq2 OR 
                       filename_seq_list2, not both.
                       Default: ''</TD></TR>
<TR><!--contents--><TD valign=top>filename_out_suffix</TD>
    <!--  type  --><TD>character(len=32)</TD>
    <!--descript--><TD>A string to be appended to each of the input observation
                       sequence file names to create the output files.
                       Default: '.common'</TD></TR>
<TR><!--contents--><TD valign=top>print_only</TD>
    <!--  type  --><TD>logical</TD>
    <!--descript--><TD>If .TRUE. do not create the output files, but print 
         a summary of the number and types of each observation in each of
         the input and output files.
                       Default: .false.</TD></TR>
<TR><!--contents--><TD valign=top>calendar</TD>
    <!--  type  --><TD>character(len=32)</TD>
    <!--descript--><TD>Set to the name of the calendar; only controls the
         printed output for the dates of the first and last observations in 
         the file.  Set this to "no_calendar" if the 
         observations are not using any calendar.
                       Default "gregorian".</TD></TR>

</TABLE>

</div>
<br>

<!--==================================================================-->

<A NAME="Building"></A>
<HR>
<H2>BUILDING</H2>

<P>
Most <tt>$DART/models/*/work</tt> directories will build the tool along with
other executable programs.  It is also possible to build the
tool in the <tt>$DART/observations/utilities</tt> directory.
The <tt>preprocess</tt> program must be built and run first, to define
what set of observation types will be supported.  See the 
<a href="../preprocess/preprocess.html">preprocess documentation</a>
for more details on how to define the list and run it.
The combined list of all observation types which will be encountered
over all input files must be in the preprocess input list.
The other important choice when building the tool is to include a
compatible locations module.  For the low-order models,
the <tt>oned</tt> module should be used; for real-world observations,
the <tt>threed_sphere</tt> module should be used.
</P>
<P>Generally the directories where executables are built will include
a "quickbuild.csh" script which will build and run preprocess and then
build the rest of the executables.  The "input.nml" namelists will need
to be edited to include all the required observation types first.
</P>

<!--==================================================================-->

<A NAME="OtherModulesUsed"></A>
<HR>
<H2>MODULES USED</H2>
<PRE>
types_mod
utilities_mod
time_manager_mod
obs_def_mod
obs_sequence_mod
</PRE>

<!--==================================================================-->
<!-- Describe the Files Used by this module.                          -->
<!--==================================================================-->

<A NAME="FilesUsed"></A>
<HR>
<H2>FILES</H2>
<UL><LI><em class="file">input.nml</em></LI>
    <LI>The input files specified in the <em class="code">filename_seq</em>
        namelist variable.</LI>
    <LI>The output file specified in the <em class="code">filename_out</em>
        namelist variable.</LI>
</UL>

<!--==================================================================-->
<!-- Cite references, if need be.                                     -->
<!--==================================================================-->

<A NAME="References"></A>
<HR>
<H2>REFERENCES</H2>
<ul>
<li> none </li>
</ul>

<!--==================================================================-->
<!-- Describe all the error conditions and codes.                     -->
<!--==================================================================-->

<A NAME="Errors"></A>
<HR>
<H2>ERROR CODES and CONDITIONS</H2>
<div class=errors>
<TABLE border=1 cellspacing=1 cellpadding=10 width=100%>
<TR><TH>Routine</TH><TH>Message</TH><TH>Comment</TH></TR>

<TR><!-- routine --><TD VALIGN=top>obs_common_subset</TD>
    <!-- message --><TD VALIGN=top>num_input_files &gt; max_num_input_files. 
		    change max_num_input_files in source file</TD>
    <!-- comment --><TD VALIGN=top>The default is 500 files.</TD>
</TR>

<TR><!-- routine --><TD VALIGN=top>obs_common_subset</TD>
    <!-- message --><TD VALIGN=top>num_input_files and filename_seq mismatch</TD>
    <!-- comment --><TD VALIGN=top>The number of filenames does not match
                        the filename count.</TD>
</TR>
</TABLE>
</div>

<H2>KNOWN BUGS</H2>
<P>
none
</P>

<!--==================================================================-->
<!-- Describe Future Plans.                                           -->
<!--==================================================================-->

<A NAME="FuturePlans"></A>
<HR>
<H2>FUTURE PLANS</H2>
<P>
Long laundry list of things this tool could do, including:
</P>
<UL>
<LI>Remove duplicates (difficult to accurately compare floating
    point values, but identical obs should be possible to recognize,
    or some epsilon could be specified.)</LI>
</UL>

<!--==================================================================-->
<!-- Legalese & Metadata                                              -->
<!--==================================================================-->

<A NAME="Legalese"></A>
<HR>
<H2>Terms of Use</H2>

<P>
DART software - Copyright &copy; 2004 - 2010 UCAR.<br>
This open source software is provided by UCAR, "as is",<br>
without charge, subject to all terms of use at<br>
<a href="http://www.image.ucar.edu/DAReS/DART/DART_download">
http://www.image.ucar.edu/DAReS/DART/DART_download</a>
</P>

<TABLE border=0 cellpadding=0 width=100% summary="">
<TR><TD valign=top>Contact:       </TD><TD> DART core group   </TD></TR>
<TR><TD valign=top>Revision:      </TD><TD> $Revision$ </TD></TR>
<TR><TD valign=top>Source:        </TD><TD> $URL$ </TD></TR>
<TR><TD valign=top>Change Date:   </TD><TD> $Date$ </TD></TR>
<TR><TD valign=top>Change&nbsp;history:&nbsp;</TD><TD> try "svn&nbsp;log" or "svn&nbsp;diff" </TD></TR>
</TABLE>

<!--==================================================================-->

</BODY>
</HTML>
